"use strict";var ke=Object.create;var K=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Re=Object.getOwnPropertyNames;var je=Object.getPrototypeOf,$e=Object.prototype.hasOwnProperty;var Be=(e,t)=>{for(var r in t)K(e,r,{get:t[r],enumerable:!0})},me=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Re(t))!$e.call(e,o)&&o!==r&&K(e,o,{get:()=>t[o],enumerable:!(i=Ge(t,o))||i.enumerable});return e};var O=(e,t,r)=>(r=e!=null?ke(je(e)):{},me(t||!e||!e.__esModule?K(r,"default",{value:e,enumerable:!0}):r,e)),He=e=>me(K({},"__esModule",{value:!0}),e);var et={};Be(et,{CldImage:()=>ae,CldOgImage:()=>se,CldUploadButton:()=>pe,CldUploadWidget:()=>X,CldVideoPlayer:()=>ue,cloudinaryLoader:()=>Z,getCldImageUrl:()=>w,getCldOgImageUrl:()=>Y,getCldVideoUrl:()=>ee});module.exports=He(et);var v=O(require("react")),we=O(require("next/image")),Te=require("@cloudinary-util/util"),_e=require("@cloudinary-util/url-loader");var Ce=O(require("next/package.json"));var ye={name:"next-cloudinary",version:"6.5.1",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.0.2","@cloudinary-util/url-loader":"5.2.2","@cloudinary-util/util":"^3.0.0","@tsconfig/recommended":"^1.0.3"},devDependencies:{"@babel/core":"^7.23.2","@babel/preset-env":"^7.23.2","@types/node":"^20.11.5","@types/react":"^18.2.33","@types/react-dom":"^18.2.14",dotenv:"^16.3.1",mkdirp:"^3.0.1",tsup:"^7.2.0",typescript:"^5.2.2",vitest:"^1.3.1"},peerDependencies:{next:"^12 || ^13 || ^14",react:"^17 || ^18"}};var Ie="A",he="V",Oe=Ee(Ce.default.version),Ue=Ee(ye.version);function Ee(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}async function Q(e){let{src:t}=e;try{await new Promise((r,i)=>{fetch(t).then(o=>{if(!o.ok){i(o);return}r(o)})})}catch(r){return r.status===423?(await new Promise(i=>setTimeout(()=>i(void 0),200)),await Q(e)):!1}return!0}function L(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let r=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,i=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:r,cloudName:t},url:{...e?.url,secureDistribution:i,privateCdn:o}},e)}function J(e){return Object.assign({product:Ie,sdkCode:he,sdkSemver:Ue,techVersion:Oe,feature:""},e)}var Pe=require("@cloudinary-util/url-loader");function w(e,t,r){return(0,Pe.constructCloudinaryUrl)({options:e,config:L(t),analytics:J(r)})}function Z({loaderOptions:e,imageProps:t,cldOptions:r,cldConfig:i={}}){let o={...t,...r};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let a=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*a))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return w(o,i)}var Xe=(0,v.forwardRef)(function(t,r){let i=!1,o=["deliveryType","preserveTransformations","strictTransformations","assetType"];_e.transformationPlugins.forEach(({props:n})=>{Object.keys(n).forEach(h=>{if(o.includes(h))throw new Error(`Option ${h} already exists!`);o.push(h)})});let a={alt:t.alt,src:t.src};Object.keys(t).filter(n=>typeof n=="string"&&!o.includes(n)).forEach(n=>a[n]=t[n]);let s=Object.keys(a).map(n=>`${n}:${a[n]}`).join(";"),[y,U]=(0,v.useState)(s),d={};if(o.forEach(n=>{let c=t[n];c&&(d[n]=c||void 0)}),t.preserveTransformations)try{let n=(0,Te.getTransformations)(t.src).map(c=>c.join(","));d.rawTransformations=[...n.flat(),...t.rawTransformations||[]]}catch(n){console.warn(`Failed to preserve transformations: ${n.message}`)}let p=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||p?.unoptimized===!0)&&(a.src=w({...d,width:a.width,height:a.height,src:a.src,format:"default",quality:"default"},t.config));async function I(n){let c=!0;if(i)return;if(i=!0,typeof t.onError=="function"){let x=t.onError(n);typeof x=="boolean"&&x===!1&&(c=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(c=!1);if(c===!1)return;let h=n.target;await Q({src:h.src})&&U(`${s};${Date.now()}`)}let N=(0,v.useCallback)(I,[Q,s]),E=we.default;return"default"in E&&(E=E.default),v.default.createElement(E,{key:y,...a,loader:n=>Z({loaderOptions:n,imageProps:a,cldOptions:d,cldConfig:t.config}),onError:N,ref:r})}),ae=Xe;var T=O(require("react")),xe=O(require("next/head"));function Y(e){return w({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var Fe="summary_large_image",qe=({excludeTags:e=[],twitterTitle:t,keys:r={},...i})=>{let{alt:o}=i,{width:a=1200,height:s=627}=i;a=typeof a=="string"?parseInt(a):a,s=typeof s=="string"?parseInt(s):s;let y=Y({...i,width:a,height:s}),U=Y({...i,width:a,height:s,format:i.format||"webp"}),d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...r};return T.default.createElement(xe.default,null,T.default.createElement("meta",{key:d["og:image"],property:"og:image",content:y}),T.default.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:y}),T.default.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${a}`}),T.default.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${s}`}),o&&T.default.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&T.default.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:t||" "}),T.default.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:Fe}),T.default.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:U}))},se=qe;var F=O(require("react"));var f=O(require("react")),Ae=O(require("next/script"));function be(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var ze=["success"],Ke={abort:"onAbort","batch-cancelled":"onBatchCancelled",close:"onClose","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"},Qe=({children:e,config:t,onError:r,onOpen:i,onUpload:o,options:a,signatureEndpoint:s,uploadPreset:y,...U})=>{let d=(0,f.useRef)(),p=(0,f.useRef)(),I=!!s,[N,E]=(0,f.useState)(void 0),[n,c]=(0,f.useState)(void 0),[h,S]=(0,f.useState)(!0),x=L(t),{cloudName:$,apiKey:P}=x?.cloud,b={cloudName:$,uploadPreset:y||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:P,...a};I&&(b.uploadSignature=M,b.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,f.useEffect)(()=>{if(typeof n>"u")return;n.event==="success"&&typeof o=="function"&&(process.env.NODE_ENVIRONMENT==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(n,p.current))},[n]);function k(){S(!1),d.current||(d.current=window.cloudinary),be(()=>{p.current||(p.current=ne())})}(0,f.useEffect)(()=>()=>{p.current?.destroy(),p.current=void 0},[]);function M(l,C){if(typeof s>"u")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(s,{method:"POST",body:JSON.stringify({paramsToSign:C}),headers:{"Content-Type":"application/json"}}).then(_=>_.json()).then(({signature:_})=>{l(_)})}function g(l,C=[]){if(p.current||(p.current=ne()),typeof p?.current[l]=="function")return p.current[l](...C)}function A(l){g("close",[l])}function G(l){return g("destroy",[l])}function q(){g("hide")}function W(){return g("isDestroyed")}function z(){return g("isMinimized")}function oe(){return g("isShowing")}function B(){g("minimize")}function re(l,C){g("open",[l,C]),typeof i=="function"&&i(p.current)}function R(){g("show")}function V(){g("update")}let D={close:A,destroy:G,hide:q,isDestroyed:W,isMinimized:z,isShowing:oe,minimize:B,open:re,show:R,update:V};function ne(){return d.current?.createUploadWidget(b,(l,C)=>{if(l&&l!==null&&(E(l),typeof r=="function"&&r(l,{widget:p.current,...D})),typeof C?.event=="string"){ze.includes(C?.event)&&c(C);let _=Ke[C.event];if(typeof _=="string"&&typeof U[_]=="function"){let ie=U[_];ie(C,{widget:p.current,...D})}}})}return f.default.createElement(f.default.Fragment,null,typeof e=="function"&&e({cloudinary:d.current,widget:p.current,results:n,error:N,isLoading:h,...D}),f.default.createElement(Ae.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:k,onError:l=>console.error(`Failed to load Cloudinary Upload Widget: ${l.message}`)}))},X=Qe;var Je=({className:e,children:t,onClick:r,onError:i,onOpen:o,onUpload:a,onAbort:s,onBatchCancelled:y,onClose:U,onDisplayChanged:d,onPublicId:p,onQueuesEnd:I,onQueuesStart:N,onRetry:E,onShowCompleted:n,onSourceChanged:c,onSuccess:h,onTags:S,onUploadAdded:x,options:$,signatureEndpoint:P,uploadPreset:b,...k})=>F.default.createElement(F.default.Fragment,null,F.default.createElement(X,{onError:i,onOpen:o,onUpload:a,onAbort:s,onBatchCancelled:y,onClose:U,onDisplayChanged:d,onPublicId:p,onQueuesEnd:I,onQueuesStart:N,onRetry:E,onShowCompleted:n,onSourceChanged:c,onSuccess:h,onTags:S,onUploadAdded:x,options:$,signatureEndpoint:P,uploadPreset:b},({open:M,isLoading:g})=>{function A(G){G.preventDefault(),M(),typeof r=="function"&&r(G)}return F.default.createElement("button",{...k,className:e||"",onClick:A,disabled:g},t||"Upload")})),pe=Je;var m=O(require("react")),Ne=O(require("next/script")),Me=O(require("next/head")),We=require("@cloudinary-util/util");var Le=require("@cloudinary-util/url-loader");function ee(e,t,r){return(0,Le.constructCloudinaryUrl)({options:{assetType:"video",format:"auto:video",...e},config:L(t),analytics:J(r)})}var te=[],ve="1.11.1",Ze=e=>{let{autoplay:t,className:r,colors:i,config:o,controls:a=!0,fontFace:s,height:y,id:U,language:d,languages:p,logo:I=!0,loop:N=!1,muted:E=!1,onDataLoad:n,onError:c,onMetadataLoad:h,onPause:S,onPlay:x,onEnded:$,poster:P,src:b,sourceTypes:k,transformation:M,quality:g="auto",width:A,...G}=e,q=Array.isArray(M)?M:[M],W=b||"";if(W.startsWith("http"))try{let u=(0,We.parseUrl)(b);typeof u?.publicId=="string"&&(W=u?.publicId)}catch{}q.unshift({quality:g});let z=(0,m.useRef)(),oe=(0,m.useRef)(),B=e.videoRef||oe,re=(0,m.useRef)(),R=e.playerRef||re,V=U||`player-${W.replace("/","-")}`,D="cld-video-player cld-fluid";r&&(D=`${D} ${r}`),te.filter(u=>u===V).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work.
    Try adding a unique id to each player.`):te.push(V);let l={error:c,loadeddata:n,loadedmetadata:h,pause:S,play:x,ended:$};function C(u){let H=l[u.type];typeof H=="function"&&H(ie())}function _(){if("cloudinary"in window){z.current=window.cloudinary;let u={};typeof I=="boolean"?u.showLogo=I:typeof I=="object"&&(u={...u,showLogo:!0,logoImageUrl:I.imageUrl,logoOnclickUrl:I.onClickUrl});let H=!1,ce;(typeof t=="boolean"||t==="true"||t==="false")&&(H=t),typeof t=="string"&&t!=="true"&&t!=="false"&&(ce=t);let ge=L(o),{cloudName:Ve}=ge?.cloud,{secureDistribution:De,privateCdn:Se}=ge?.url,j={cloud_name:Ve,privateCdn:Se,secureDistribution:De,autoplayMode:ce,autoplay:H,controls:a,fontFace:s||"",language:d,languages:p,loop:N,muted:E,publicId:W,width:A,height:y,aspectRatio:`${A}:${y}`,transformation:q,...u,...G};Array.isArray(k)&&(j.sourceTypes=k),typeof i=="object"&&(j.colors=i),typeof P=="string"?j.posterOptions={publicId:P}:typeof P=="object"&&(typeof P.src!="string"?j.posterOptions={publicId:ee({...P,src:W,format:"auto:image"})}:j.posterOptions={publicId:w(P)}),R.current=z.current.videoPlayer(B.current,j),Object.keys(l).forEach(fe=>{typeof l[fe]=="function"&&R.current?.on(fe,C)})}}(0,m.useEffect)(()=>()=>{R.current?.videojs.cloudinary.dispose(),te=te.filter(u=>u!==V)},[]);function ie(){return{player:R.current,video:B.current}}return m.default.createElement(m.default.Fragment,null,m.default.createElement(Me.default,null,m.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${ve}/dist/cld-video-player.min.css`,rel:"stylesheet"})),m.default.createElement("div",{style:{width:"100%",aspectRatio:`${A} / ${y}`}},m.default.createElement("video",{ref:B,id:V,className:D,width:A,height:y}),m.default.createElement(Ne.default,{id:`cloudinary-videoplayer-${V}-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${ve}/dist/cld-video-player.min.js`,onLoad:_,onError:u=>console.error(`Failed to load Cloudinary Video Player: ${u.message}`)})))},ue=Ze;0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map